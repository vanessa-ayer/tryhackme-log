<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>{{ page.title }} - {{ site.title }}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link
			rel="stylesheet"
			href="{{ '/assets/css/custom.css' | relative_url }}"
		/>
	</head>
	<body>
		<div class="site">
			<header class="site-header">
				<h1 class="site-title">
					<a href="{{ site.baseurl | prepend: site.url }}">{{ site.title }}</a>
				</h1>
				<p class="site-desc">{{ site.description }}</p>
				<div class="xpbar">
					<div class="xp-meta">ðŸ’€ Level 1 â€” 50 XP / 500 XP</div>
					<div class="xp-track">
						<div class="xp-fill" style="width: 10%"></div>
					</div>
				</div>
			</header>

			<main class="site-content">
				<h1 class="type-header title" data-text="{{ page.title }}">
					<span class="type-target"></span><span class="cursor"></span>
				</h1>

				<p class="post-meta">
					$ logged by <span class="author">Vanessa Ayer</span>
				</p>

				{{ content }}
				<hr class="divider" />

				<p class="return-link">
					<a
						href="{{ site.baseurl }}/"
						aria-label="Exit room and return to home"
					>
						<span class="type-target" data-text="&lt; exit room"></span>
						<span class="cursor"></span>
					</a>
				</p>
			</main>

			<footer class="site-footer">
				<p>Made by Vanessa â€¢ <small>TryHackMe Journey</small></p>
			</footer>
		</div>
		<script>
			(function () {
				// --- config ---
				var speedPerChar = 28; // ms per char
				var triggerEarly = '0px 0px -20% 0px'; // start when 80% into viewport

				function typeText(target, text, speed, done) {
					var i = 0;
					(function tick() {
						target.textContent = text.slice(0, i++);
						if (i <= text.length) setTimeout(tick, speed);
						else if (done) done();
					})();
				}

				// HEADERS (title + section headers)
				var headers = [].slice.call(document.querySelectorAll('.type-header'));
				function observeHeaders() {
					if (!('IntersectionObserver' in window)) {
						headers.forEach(function (h) {
							var tgt = h.querySelector('.type-target');
							if (tgt)
								typeText(tgt, h.getAttribute('data-text') || '', speedPerChar);
						});
						// fallback: also type exit link immediately
						typeExitImmediate();
						return;
					}

					var seen = new WeakSet();
					var ioHeaders = new IntersectionObserver(
						function (entries) {
							entries.forEach(function (entry) {
								if (entry.isIntersecting && !seen.has(entry.target)) {
									seen.add(entry.target);
									var el = entry.target;
									var tgt = el.querySelector('.type-target');
									if (tgt)
										typeText(
											tgt,
											el.getAttribute('data-text') || '',
											speedPerChar
										);
									ioHeaders.unobserve(el);
								}
							});
						},
						{ root: null, rootMargin: triggerEarly, threshold: 0 }
					);

					headers.forEach(function (h) {
						ioHeaders.observe(h);
					});
				}

				// EXIT LINK (use its own, separate observer)
				function observeExit() {
					var exitWrapper = document.querySelector('.return-link');
					var exitTarget = document.querySelector('.return-link .type-target');
					if (!exitWrapper || !exitTarget) return;

					if (!('IntersectionObserver' in window)) {
						typeExitImmediate();
						return;
					}

					var typed = false;
					var ioExit = new IntersectionObserver(
						function (entries) {
							entries.forEach(function (e) {
								if (e.target === exitWrapper && e.isIntersecting && !typed) {
									typed = true;
									typeText(
										exitTarget,
										exitTarget.getAttribute('data-text') || '',
										speedPerChar
									);
									ioExit.unobserve(exitWrapper);
								}
							});
						},
						{ root: null, rootMargin: triggerEarly, threshold: 0 }
					);

					ioExit.observe(exitWrapper);
				}

				function typeExitImmediate() {
					var exitTarget = document.querySelector('.return-link .type-target');
					if (!exitTarget) return;
					typeText(
						exitTarget,
						exitTarget.getAttribute('data-text') || '',
						speedPerChar
					);
				}

				// Kick off observers
				observeHeaders();
				observeExit();
			})();
		</script>
	</body>
</html>
